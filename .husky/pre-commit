#!/usr/bin/env bash
set -euo pipefail

# Fail-soft docs generation guard

if [[ "${SKIP_DOCS_GENERATION:-}" == "1" ]]; then exit 0; fi
DOC_DIR="documentation"
GEN_SCRIPT="${DOCS_GEN_SCRIPT:-scripts/generate-docs.mjs}"
if [ -d "$DOC_DIR" ]; then
  if git diff --cached --name-only | grep -Eq "^(documentation/|scripts/generate-docs|tools/docs)"; then
    if [ -f "$GEN_SCRIPT" ]; then
      echo "[pre-commit] generating docs…"
      pnpm -s docs:generate || { echo "[pre-commit] WARN: docs generation failed — commit allowed"; exit 0; }
    else
      echo "[pre-commit] INFO: no generator script found, skipping"
    fi
  fi
fi
exit 0
