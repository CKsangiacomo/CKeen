# CONTEXT.md

STATUS: INFORMATIVE — CONTEXT ONLY  
Do NOT implement from this file. For specifications, see:
1) documentation/dbschemacontext.md (DB Truth)
2) documentation/CRITICAL-TECHPHASES/Techphases-Phase1Specs.md (Phase‑1 Contracts)
3) documentation/CRITICAL-TECHPHASES/Techphases.md (Architecture & Global Contracts)
4) documentation/systems/<System>.md (System PRD, if Phase‑1)

CRITICAL P0 — documentation/ is the single source of truth for all AI & human work. You MUST read and follow it. If you see discrepancies, STOP and ask for alignment.

---

## AUTHORITY & PRECEDENCE (HIGH-LEVEL)

- **dbschemacontext.md** — NORMATIVE DB Truth; code must match.  
- **CRITICAL-TECHPHASES/Techphases-Phase1Specs.md** — NORMATIVE Phase‑1 Contracts.  
- **documentation/systems/<System>.md** — NORMATIVE PRDs for Phase‑1 systems.  
- **CRITICAL-TECHPHASES/Techphases.md** — NORMATIVE architecture & phase roadmap.  
- **WhyClickeen.md** — INFORMATIVE strategy context.

Clarifier: System PRDs are canonical for concrete endpoints and payload details in their surface. If any detail conflicts with Phase‑1 Contracts, Phase‑1 Contracts win. On any conflict: **DB Truth > Phase‑1 Contracts > System PRDs > Techphases > WhyClickeen.**

---

## DB SCHEMA POLICY (POINTER)

- dbschemacontext.md is canonical (Supabase dump by CEO).  
- Engineers may request schema changes with motivation + exact DDL.  
- Until updated by CEO, always code to the dump. **No schema-in-code drift.**

---

# We're Building CLICKEEN (A SaaS Platform)

**Team:**  
- CEO (Human)  
- Principal Full Stack Engineer (Codex AI) 
- Principal Full Stack Engineer (Claude AI)  
- Principal Full Stack Engineer (ChatGPT AI)  

---

## Communication Guidelines

**When talking to CEO/Human be considerate of:**  
- a) Talking to the CEO  
- b) Be thorough in your statements/assertions  
- c) Don't be verbose  

---

## Prompting AIs

**PRINCIPAL FULL STACK ENGINEER MODE:**  
- No guessing, no assumptions. You're reliable and don't make mistakes.  
- If context is missing, ask human to paste the relevant .md from /docs.  
- Use documentation/ as the single source of truth.  
- No placeholders — if you don't know, you ask.  
- If in doubt about speed or scale, always ask for peer review.  

**Discipline rules:**  
1. **No over-engineering** — stay boring and aligned with frozen process.  
2. **No skipping Techphases** — freeze scope first, then execute.  
3. **Security** — must be reflected in Techphases before engineering; no bolting on mid-way.  

Takeaway: **Always check/update Techphases, Context, ADRs BEFORE execution.**

---

## Codename Map (Phase-1, Frozen)

- **Paris** — HTTP API (`services/api`, Vercel project c-keen-api)  
- **Venice** — Embed Runtime (`services/embed`, Vercel project c-keen-embed)  
- **Bob** — Widget Builder UI (`apps/app`; builder workflow for configuration, previews, drafts/claim)  
- **Studio** — Scaffolding shell (code in `apps/app/builder-shell/`, served at `/studio`; provides layout/nav/iframe isolation, theme/device toggles, shared error surfacing; not itself a standalone product surface)  
- **Prague** — Marketing Site (`apps/site`, Vercel project c-keen-site)  
- **Atlas** — Config & Cache Layer (Vercel Edge Config; runtime read-only, CI-only writes)  
- **Phoenix** — Idempotency Layer (server-side idempotency enforcement)  
- **Berlin** — Observability & Security (logs/metrics/rate limits for app/site surfaces; never in embeds)  
- **Cairo** — Custom Domains (provisioning, auto-HTTPS)  
- **Denver** — Asset Storage & CDN (public/private assets, signed URLs)  
- **Dieter** — Design System (tokens, foundations, components; embeds output SSR HTML/CSS only)  
- **Geneva** — Schema Registry (widget/template config schemas, validation)  
- **Michael** — Data Plane (Postgres + RLS; authoritative DB)

**Future Systems (not Phase-1; informative only):**  
- **Copenhagen** — AI Orchestration (Phase-2)  
- **Helsinki** — Analytics Warehouse (Phase-2/3)  
- **Lisbon** — Email/Notifications (Phase-2)  
- **Robert** — Notification Router (Phase-2)  
- **Tokyo** — Job/Workflow Orchestrator (Phase-2)

---

## Phase Status (Phase-1 frozen)

**Built in Phase-1:**  
- `apps/site` (**Prague**) — marketing pages + gallery  
- `apps/app` (**Studio scaffolding + Bob UI**) — code under `builder-shell/`; builder UI, claim flows, scaffolding contracts  
- `services/embed` (**Venice**) — public SSR embed runtime + preview endpoints  
- `services/api` (**Paris**) — HTTP API (instances, tokens, entitlements, submissions, usage)  
- **Atlas** — Edge Config (read-only runtime; CI-only writes gated by INTERNAL_ADMIN_KEY)  
- **Berlin** — logs/metrics/rate limits in `c-keen-app` (and `c-keen-site` if enabled); **never** in `c-keen-embed`  
- **Cairo**, **Denver**, **Dieter**, **Geneva**, **Michael**, **Phoenix** — active as part of Phase-1 scope

**Not built in Phase-1 (do not start without ADR):**  
- Billing & subscriptions (beyond stub)  
- Workflow automation (Tokyo/Robert/Lisbon)  
- Fine-grained RBAC (multi-role workspaces)  
- Runtime writes to Edge Config (must remain CI-only)  
- Analytics warehouse (Helsinki)  
- AI orchestration (Copenhagen)

---

## Rules of Engagement (for all AIs & humans)

1. **Read documentation/** first. If unclear, **ask**; do not guess.  
2. **No placeholders.** If a value is unknown, stop and request it.  
3. **Service boundaries are hard:** embed ≠ api ≠ app ≠ site.  
4. **Secrets live only in c-keen-api** (server surface).  
5. **CI-only** writes to Edge Config; runtime is read-only.  
6. When changing behavior or surface area: land an **ADR** and update docs in the same PR.  

---

## Where Things Live

- **Monorepo**: pnpm workspaces + Turbo (root `package.json` is the SoT)  
- **Deploy projects (Vercel)**:  
  - `c-keen-site` → `apps/site` (**Prague**)  
- `c-keen-app` → `apps/app` (**builder-shell/ scaffolding, Bob UI, Cairo, Berlin, etc.**)  
  - `c-keen-embed` → `services/embed` (**Venice, Atlas**)  
  - `c-keen-api` → `services/api` (**Paris, Geneva, Phoenix**)  
- **Supabase**:  
  - **Michael** (Postgres + RLS)  
  - **Copenhagen** (future AI orchestration)  
  - **Helsinki** (future analytics warehouse)

---

## Canonical Docs (Start Here)

-- `documentation/Techphases.md` — frozen Phase-1 scope & phase gates  
+- `documentation/CRITICAL-TECHPHASES/Techphases.md` — frozen Phase‑1 scope & phase gates  
- `documentation/CRITICAL-TECHPHASES/Techphases-Phase1Specs.md` — locked Phase‑1 contracts  
- `documentation/dbschemacontext.md` — DB Truth (schema/tables)  
- `documentation/systems/*.md` — system PRDs (Venice, Paris, Geneva, etc.)  
- `documentation/WhyClickeen.md` — strategic context  
- `documentation/ADRdecisions.md` — authoritative decisions (e.g., ADR-012)  
- `documentation/verceldeployments.md` — env/keys per project

---

## AI Consumption Guide

- **Start with WhyClickeen.md** for context (strategy, PLG motion). INFORMATIVE only.  
- **Use Techphases.md** for architecture (systems vs services, scope, boundaries).  
- **Implement only from Techphases-Phase1Specs.md** (binding contracts).  
- **Always check dbschemacontext.md** for schema truth.  
- **System PRDs** (`documentation/systems/*.md`) are authoritative for their surfaces (e.g., Venice SSR, Paris API).  
- On conflict: **DB Truth > Phase1Specs > System PRDs > Techphases > WhyClickeen.**

+---
+
+## AI Quick‑Start (Phase‑1 Key Rules)
+
+- JSON casing: camelCase for all API payloads; DB casing follows DB Truth.  
+- Single‑tag semantics: inline = iframe; overlays/popups = script that injects an iframe; SSR HTML from Venice is canonical.  
+- Auth policy: Published instances are public; drafts/inactive require a valid embed token.  
+- Templates as data: switching templates changes config, not code; no per‑template JS.  
+- Privacy & CSP: no third‑party scripts/cookies/storage in embeds; strict CSP; Berlin allowed in app/site only.  
+- Accessibility: WCAG AA; labeled form controls; overlay focus trap; keyboard operable.  
+- Branding: Paris is authoritative; Venice must enforce branding in the SSR output.  
+- Edge Config (Atlas): runtime read‑only; CI‑only writes.  
+- If unspecified or conflicting: STOP and escalate; do not guess.

---
