/*! Clickeen P1 Telemetry (no PII) */
export async function sha256Base64(s){try{if(typeof crypto==='undefined'||!('subtle'in crypto))return'';const e=new TextEncoder().encode(s),t=await crypto.subtle.digest('SHA-256',e),n=new Uint8Array(t);let r='';for(let e=0;e<n.length;e++)r+=String.fromCharCode(n[e]);return btoa(r)}catch{return''}}
export function uuidv4(){const e=typeof crypto!='undefined'&&'getRandomValues'in crypto?crypto:null;if(!e)return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,(e=>{const t=Math.random()*16|0,n=e==='x'?t:t&3|8;return n.toString(16)}));const t=new Uint8Array(16);e.getRandomValues(t),t[6]=15&t[6]|64,t[8]=63&t[8]|128;const n=e=>e.toString(16).padStart(2,'0');return`${n(t[0])}${n(t[1])}${n(t[2])}${n(t[3])}-${n(t[4])}${n(t[5])}-${n(t[6])}${n(t[7])}-${n(t[8])}${n(t[9])}-${n(t[10])}${n(t[11])}${n(t[12])}${n(t[13])}${n(t[14])}${n(t[15])}`}
export async function emitWidgetEvent(e,t,n,r){try{if(!t?.workspace_id||!t?.widget_id)return;const i=typeof location!='undefined'?location.origin:'',o=typeof location!='undefined'?location.pathname:'',a=await sha256Base64(i+o),s={event_name:n,event_id:uuidv4(),ts:Date.now(),workspace_id:t.workspace_id,widget_id:t.widget_id,token_id:null,cfg_version:t.cfg_version??null,embed_version:t.embed_version??null,client_run_id:null,page_origin_hash:a,payload:r??null};await fetch(e.replace(/\/$/,'')+'/api/ingest',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify(s),keepalive:!0,credentials:'omit',cache:'no-store'}).catch(()=>{})}catch{}}


